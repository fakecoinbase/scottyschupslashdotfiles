# My custom shell functions, most of which should probably be scripts in a bin somewhere. A project for another day

function cd_atom {
  cd $1 && atom .
}

function cd_ll {
  cd $1 && k -Ah
}

function git_add_commit {
  if [ $2 ]; then
    g_add=$1
    g_msg=$2
  else
    return "Enter a commit message"
  fi
  git add $g_add; git commit -m $g_msg;
}

function git_add_commit_push {
  gac $1 $2
  g_branch=$(git rev-parse --symbolic-full-name --abbrev-ref HEAD)
  git push -u origin $g_branch
}

function git_branch_delete_remote {
  if [ $2 ]; then
    remote=$1
    branch=$2
  else
    remote='origin'
    branch=$1
  fi
  git push $remote --delete $branch
}

function git_branch_delete_local_and_remotes {
  if [ ! -n $1 ]; then
    return 'Must enter at least a branch name'
  fi
  remotes=( "$@" )
  unset "remotes[$#]"

  for remote in $remotes; do
    shift
  done

  if [ $remotes[1] ]; then
    for remote in $remotes; do
      git_branch_delete_remote $remote $@
    done
  else
    git_branch_delete_remote $@
  fi

  git branch -D $@
}

function git_commit_push {
  git commit -m $1 && git push
}

function git_diff_file {
  if [ $3 ]; then
    commit2=$3
  else
    commit2="HEAD"
  fi

  if [ $2 ]; then
    file=$1
    commit1=$2
    git diff $commit1 $commit2 $file
  else
    echo "Usage: git_diff_file COMMIT FILE_NAME" >&2; exit 1
  fi
}

function git_ignore_and_remove {
  echo $1 >> ./.gitignore; git rm --cached $1
}

function git_lastnhashes {
  git rev-list --max-count=$1 HEAD
}

function mkdir_cd {
  if [ ! -n "$1" ]; then
    echo "Enter a directory name"
  elif [ -d $1 ]; then
    echo "\`$1' already exists"
  else
    mkdir $1 && cd $1
  fi
}

function new_react_project {
  GRN='\033[0;32m'
  NONE='\033[0m'

  echo "${GRN}initialize directory${NONE}"
  mkcd $1 &&
  echo "${GRN}create package.json${NONE}"
  npm init --yes &&
  echo "${GRN}install react components${NONE}"
  react_install &&
  echo "${GRN}install webpack${NONE}"
  react_webpack &&
  echo "${GRN}install babel components${NONE}"
  react_babel_install &&
  echo "${GRN}create index.html${NONE}"
  touch index.html &&
  echo "${GRN}create lib/${NONE}"
  mkdir lib &&
  echo "${GRN}create lib/app.jsx${NONE}"
  touch lib/app.jsx &&
  echo "${GRN}initialize git repo${NONE}"
  git init &&
  gac . "initial commit" &&
  atom . &&
  wp --watch

}

function omni_killer {
  for pid in $(pids_for $1); do
    kill -9 $pid;
  done
}

function over {
  cd ../$1
}

function pids_for {
  ps aux |
  grep $1 |
  grep -v grep |
  awk '{print $2}' |
  tr '\n' ' ' |
  sed 's/\s$//'
}

function ping_google {
  if [ $1 ]; then
    $count=$1
  else
    $count=5
  fi

  ping -c $count google.com
}

function rails_new {
  rails _4.2.5.1_ new $1 --rc="~/.railsrc" --template="~/.railsrc"
}

function rails_reset {
  mysql.server restart &&
  bundle install &&
  rake db:drop &&
  rake db:create &&
  rake db:migrate &&
  rake db:seed &&
  rails server
}

function reload_redis {
  if [ $1 ]; then
    new_dump_file=$1
  else
    new_dump_file="sony.rdb"
  fi
  cp "$ANALYTICS_HOME/$new_dump_file" "$ANALYTICS_HOME/sawmill/dump.rdb"
}

function untarAll {
  for file in $( ls ); do
    dir=${file%.tar};
    mkdir $dir;
    tar -C $dir/ -xvf $file;
  done
}

function untargzAll {
   for file in $( ls ); do
    dir=${file%.tar};
    mkdir $dir;
    tar -C $dir/ -zxvf $file;
  done
}

function which_cd {
  cd `which $1 | xargs dirname`
}

function which_cd_ll {
  cd `which $1 | xargs dirname` && k -Ah
}

function z_atom {
  z $1 && atom .
}

function z_ll {
  z $1 && k -Ah
}
